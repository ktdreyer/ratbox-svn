# $Id$

CC=@CC@
RM=@RM@
MV=@MV@
INSTALL=@INSTALL@
LEX=@LEX@
LEXLIB=@LEXLIB@
YACC=@YACC@
PREFIX=@prefix@
BIN=rserv@EXEEXT@
INCLUDES=-I ../include/
LDFLAGS=
LIBS=@LIBS@ -lsqlite
CFLAGS=-g -O0 -Wall -Werror -Wunused -Wshadow -Wmissing-declarations -Wwrite-strings -DPREFIX=\"$(PREFIX)\"
MAKE = make

# Anything marked with the .PHONY attribute is always considered "out of date"
.PHONY: $(BIN)

BSRCS = 		\
        balloc.c        \
        c_error.c       \
	c_message.c	\
	c_mode.c	\
        cache.c         \
	channel.c	\
	client.c	\
	crypt.c		\
	conf.c		\
	event.c		\
	hook.c		\
	io.c		\
	log.c		\
	match.c		\
	modebuild.c	\
        newconf.c       \
	rserv.c		\
	scommand.c	\
	service.c	\
	tools.c		\
        u_stats.c       \
	ucommand.c

SRCS = ${BSRCS} @S_USERSERV@ @S_CHANSERV@ @S_ALIS@ @S_OPERBOT@ @S_JUPESERV@

OBJS=$(SRCS:.c=.o)

all: $(BIN)

$(BIN): $(OBJS) y.tab.o lex.yy.o
	${CC} ${CFLAGS} ${LDFLAGS} -o $@ ${OBJS} y.tab.o lex.yy.o $(LIBS) $(LEXLIB)

.c.o:
	${CC} $(INCLUDES) ${CFLAGS} -c $<

y.tab.o:	y.tab.c parser.y
	$(CC) $(INCLUDES) -I. $(CFLAGS) -c y.tab.c

y.tab.c:	parser.y
	$(YACC) -d parser.y

lex.yy.o:	lex.yy.c lexer.l
	$(CC) $(INCLUDES) -I. $(CFLAGS) -c lex.yy.c

lex.yy.c:	lexer.l
	$(LEX) lexer.l

build: $(BIN)

clean:
	$(RM) -f $(BIN) *.o y.tab.* lex.yy.c

distclean: clean
	$(RM) Makefile

depend:
	$(CC) -MM $(INCLUDES) $(CFLAGS) $(SRCS) > .depend

install:

include .depend
