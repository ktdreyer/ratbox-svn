#
# Makefile.in for ircd/src
#
# $Id$
#
CC		= @CC@
RM		= @RM@
LEX		= @LEX@
LEXLIB		= @LEXLIB@
CFLAGS		= @CFLAGS@
LDFLAGS   	= -Wl,-export-dynamic
MKDEP		= ${CC} -MM

IRCDLIBS	= @LIBS@ @SSL_LIBS@ @DL_DEFINE@

INCLUDES	= -I../include
CPPFLAGS	= ${INCLUDES} @SSL_DEFINE@ @CPPFLAGS@
 
default:	all

y.tab.o:	y.tab.c ircd_parser.y
	gcc -g -I ../include -I. -c y.tab.c

y.tab.c:	ircd_parser.y
	yacc -d ircd_parser.y

lex.yy.o:	lex.yy.c ircd_lexer.l
	gcc -g -I ../include -c lex.yy.c

lex.yy.c:	ircd_lexer.l
	${LEX} ircd_lexer.l

SRCS =                          \
  blalloc.c                     \
  channel.c                     \
  vchannel.c                    \
  class.c                       \
  client.c                      \
  dbuf.c                        \
  dline_conf.c                  \
  event.c                       \
  fdlist.c                      \
  fileio.c                      \
  flud.c                        \
  hash.c                        \
  irc_string.c                  \
  ircd.c                        \
  ircdauth.c                    \
  ircd_signal.c                 \
  list.c                        \
  listener.c                    \
  m_error.c                     \
  match.c                       \
  modules.c                     \
  motd.c                        \
  mtrie_conf.c                  \
  oldparse.c			\
  oratime.c                     \
  numeric.c                     \
  packet.c                      \
  parse.c                       \
  res.c                         \
  rsa.c                         \
  restart.c                     \
  s_auth.c                      \
  s_bsd.c                       \
  @SELECT_SRC@                  \
  s_conf.c                      \
  s_debug.c                     \
  s_log.c                       \
  s_misc.c                      \
  s_serv.c                      \
  s_stats.c                     \
  s_user.c                      \
  scache.c                      \
  send.c                        \
  sprintf_irc.c                 \
  whowas.c

OBJS = ${SRCS:.c=.o}

all: ircd

build: all

ircd: ${OBJS} y.tab.o lex.yy.o version.o
	${CC} ${LDFLAGS} -o $@ ${OBJS} lex.yy.o y.tab.o version.o ${IRCDLIBS} ${LEXLIB}
	mv version.c version.c.last

install: build
	@echo "Please do a make install from the top level directory"

version.c: version.c.SH
	/bin/sh ./version.c.SH


# this is really the default rule for c files
.c.o:
	${CC} ${CPPFLAGS} ${CFLAGS} -c $<

.PHONY: depend clean distclean
depend:
	${MKDEP} ${CPPFLAGS} ${SRCS} > .depend

clean:
	${RM} -f *.o *.exe *~ y.tab.c lex.yy.c ircd.core core ircd 

distclean: clean
	${RM} -f Makefile version.c.last

include .depend

