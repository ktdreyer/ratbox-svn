# $Id$

RM=@RM@
INSTALL=@INSTALL@
BIN=ratbox-services@EXEEXT@
LIBS=@LIBS@
LDFLAGS=@LDFLAGS@

SUBDIRS=@SQLITE_SUBDIR@ src help

prefix=@prefix@
exec_prefix=@prefix@
sbindir=@sbindir@
sysconfdir=@sysconfdir@
datadir=@datadir@
localstatedir=@localstatedir@
logdir=@logdir@
rundir=@rundir@
helpdir=@helpdir@

@SET_MAKE@

all: build

autoconf:
	autoconf autoconf/configure.in >configure
	autoheader -l autoconf autoconf/configure.in > include/setup.h.in
	$(RM) -f config.cache

build:
	@for i in $(SUBDIRS); do \
		echo "build -> $$i"; \
		cd $$i; \
		$(MAKE) all || exit; cd ..; \
	done

install: build
	$(INSTALL) -m 750 -d $(prefix)
	$(INSTALL) -m 750 -d $(sbindir)
	$(INSTALL) -m 750 -d $(sysconfdir)
	$(INSTALL) -m 750 -d $(logdir)
	$(INSTALL) -m 750 -d $(rundir)
	$(INSTALL) -m 750 -d $(helpdir)
	$(INSTALL) -m 750 src/$(BIN) $(sbindir)
	$(INSTALL) -m 640 doc/example.conf $(sysconfdir)
	$(INSTALL) -m 640 doc/schema.txt $(sysconfdir)
	@for i in $(SUBDIRS); do \
		echo "install -> $$i"; \
		cd $$i; \
		$(MAKE) install; cd ..; \
	done


clean:
	@for i in $(SUBDIRS); do \
		echo "clean -> $$i"; \
		cd $$i; \
		$(MAKE) clean; cd ..; \
	done

distclean:
	$(RM) -f Makefile 
	$(RM) config.status config.cache config.log include/setup.h
	@for i in $(SUBDIRS); do \
		echo "distclean -> $$i"; \
		cd $$i; \
		$(MAKE) distclean; cd ..; \
	done

depend:
	@for i in $(SUBDIRS); do \
		echo "depend -> $$i"; \
		cd $$i; \
		$(MAKE) depend; cd ..; \
	done

