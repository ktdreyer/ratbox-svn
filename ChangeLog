leeh        2008/12/14 20:48:15 UTC	(20081214_0-26300)
  Log:
  - track the pass numbers through an integer
  

  Modified:
	rserv/trunk/src/stest_schema.c (File Modified) 


leeh        2008/11/24 22:17:53 UTC	(20081124_4-26250)
  Log:
  - make rsdb_schema_check() take an optional param of whether to run the sql
    or not, and make it return the number of sql commands it found to do
  - extend the schema test to run another quick couple of passes to check
    there are no mods to do
  

  Modified:
	rserv/trunk/include/rsdbs.h (File Modified) 
	rserv/trunk/src/rsdbs_common.c (File Modified) 
	rserv/trunk/src/rsdbs_schema.c (File Modified) 
	rserv/trunk/src/stest_schema.c (File Modified) 


leeh        2008/11/24 21:53:02 UTC	(20081124_3-26248)
  Log:
  - should be testing non-unique indexes for unique being 0, not 1
  

  Modified:
	rserv/trunk/src/rsdbs_sqlite3.c (File Modified) 


leeh        2008/11/24 21:50:24 UTC	(20081124_2-26246)
  Log:
  - fill in rsdbs_check_key_pri()
  

  Modified:
	rserv/trunk/src/rsdbs_sqlite3.c (File Modified) 


leeh        2008/11/24 20:56:15 UTC	(20081124_1-26244)
  Log:
  - add rsdbs_pragma_header_pos(), to run a pragma and go back through the
    header line to find the position of a given column
  - make rsdbs_check_column() use rsdbs_pragma_header_pos()
  - add rsdbs_check_key_index_list() to search an index list for a given
    constraint
  - make rsdbs_check_key_unique() and rsdbs_check_key_index() call
    rsdbs_check_key_index_list()
  

  Modified:
	rserv/trunk/src/rsdbs_sqlite3.c (File Modified) 


leeh        2008/11/24 20:29:13 UTC	(20081124_0-26242)
  Log:
  - move an fprintf() up slightly so we can tell what sql its executing
  - make rsdb_init() for sqlite handle the dbname param.  This should probably
    be reworked slightly, as it means the conf can influence the dbpath..
  - add shell for rsdbs_check_deletekey_index()
  - fix rsdbs_sql_create_key() to handle index names like the others
  

  Modified:
	rserv/trunk/src/rsdb_sqlite3.c (File Modified) 
	rserv/trunk/src/rsdbs_common.c (File Modified) 
	rserv/trunk/src/rsdbs_sqlite3.c (File Modified) 


leeh        2008/11/19 19:38:26 UTC	(20081119_2-26230)
  Log:
  - fix rsdbs_check_key_index() to not locate UNIQUE constraints
  - fill in rsdbs_check_deletekey_index()
  - add rsdbs_sql_drop_key_index() to check if an INDEX exists, and return the
    sql to drop it
  

  Modified:
	rserv/trunk/src/rsdbs_mysql.c (File Modified) 


leeh        2008/11/19 19:23:15 UTC	(20081119_1-26228)
  Log:
  - rsdbs_check_deletekey_unique() for mysql
  

  Modified:
	rserv/trunk/src/rsdbs_mysql.c (File Modified) 


leeh        2008/11/19 19:16:39 UTC	(20081119_0-26226)
  Log:
  - fix rsdbs_sql_drop_key_unique() so it only generates SQL if its needed
  - improve rsdbs_check_key_kcu() so it properly checks the fields are correct
  - clean out rsdbs_check_deletekey_unique() until it can be done properly
  

  Modified:
	rserv/trunk/src/rsdbs_mysql.c (File Modified) 


leeh        2008/11/18 21:39:06 UTC	(20081118_2-26224)
  Log:
  - add a schema test for expanding an INDEX
  

  Modified:
	rserv/trunk/src/stest_schema.c (File Modified) 


leeh        2008/11/18 21:35:51 UTC	(20081118_1-26222)
  Log:
  - add in a special exception when checking the schema, so that if we are
    adding a SERIAL field that we drop any existing PRIMARY KEY before we add
    the SERIAL field itself
  

  Modified:
	rserv/trunk/include/rsdbs.h (File Modified) 
	rserv/trunk/src/rsdbs_common.c (File Modified) 


leeh        2008/11/18 21:28:30 UTC	(20081118_0-26220)
  Log:
  - add in a schema test for adding a SERIAL column into a table with an
    existing PRIMARY KEY
  

  Modified:
	rserv/trunk/src/stest_schema.c (File Modified) 


leeh        2008/11/16 22:07:37 UTC	(20081116_9-26216)
  Log:
  - add in rsdbs_sql_drop_key_index(), to return the SQL for dropping an INDEX
  - add in rsdbs_check_deletekey_index(), which will check a table and remove
    any indexes that shouldn't exist
  - make schema_test() check for unwanted indexes
  - extend the schematest to test dropping an index
  

  Modified:
	rserv/trunk/include/rsdbs.h (File Modified) 
	rserv/trunk/src/rsdbs_common.c (File Modified) 
	rserv/trunk/src/rsdbs_pgsql.c (File Modified) 
	rserv/trunk/src/stest_schema.c (File Modified) 


leeh        2008/11/16 20:09:06 UTC	(20081116_8-26214)
  Log:
  - remove an unused variable
  

  Modified:
	rserv/trunk/src/rsdbs_common.c (File Modified) 


leeh        2008/11/16 20:08:28 UTC	(20081116_7-26212)
  Log:
  - rsdbs_sql_drop_key_unique() was missing the table_name part from the SQL
    to check if the constraint exists
  - rsdbs_check_key_is() does not need to return whether the constraint exists
    or not, that is handled by rsdbs_sql_drop_key_unique() later
  - rsdbs_check_deletekey_unique() wasn't generating the index name from the
    parameters
  - fix rsdbs_check_deletekey_unique() testing the wrong list for things to
    delete
  - fix rsdbs_check_table() so that it trusts rsdbs_sql_drop_key_unique() on
    whether the constraint exists
  

  Modified:
	rserv/trunk/src/rsdbs_common.c (File Modified) 
	rserv/trunk/src/rsdbs_pgsql.c (File Modified) 


leeh        2008/11/16 19:59:01 UTC	(20081116_6-26210)
  Log:
  - expand the schematest with a unique constraint to drop
  

  Modified:
	rserv/trunk/src/stest_schema.c (File Modified) 


leeh        2008/11/16 19:23:32 UTC	(20081116_5-26208)
  Log:
  - revert r26202, turns out I don't need it:
    - move the logic in rsdbs_sql_create_key() into a new
      rsdbs_sql_create_key_str() which takes the raw params, and make
      rsdbs_sql_create_key() simply pass it the correct params
  

  Modified:
	rserv/trunk/src/rsdbs_pgsql.c (File Modified) 


leeh        2008/11/16 19:20:33 UTC	(20081116_4-26206)
  Log:
  - flesh out rsdbs_check_deletekey_unique() for postgres
  - rework rsdb_schema_check() slightly, so that it checks for invalid UNIQUE
    constraints and drops them where appropriate
  

  Modified:
	rserv/trunk/src/rsdbs_common.c (File Modified) 
	rserv/trunk/src/rsdbs_pgsql.c (File Modified) 


leeh        2008/11/16 19:02:13 UTC	(20081116_3-26204)
  Log:
  - simplify rsdbs_check_key_is() so that it matches on constraint names, and
    make it differentiate situations where the key is correct, the key is
    incorrect (i.e. missing/extra fields), or the key does not exist at all
  

  Modified:
	rserv/trunk/src/rsdbs_pgsql.c (File Modified) 


leeh        2008/11/16 18:57:00 UTC	(20081116_2-26202)
  Log:
  - move the logic in rsdbs_sql_create_key() into a new
    rsdbs_sql_create_key_str() which takes the raw params, and make
    rsdbs_sql_create_key() simply pass it the correct params
  

  Modified:
	rserv/trunk/src/rsdbs_pgsql.c (File Modified) 


leeh        2008/11/16 18:06:55 UTC	(20081116_1-26200)
  Log:
  - add in dlink_find_string_destroy()
  

  Modified:
	rserv/trunk/include/tools.h (File Modified) 
	rserv/trunk/src/tools.c (File Modified) 


leeh        2008/11/16 11:48:29 UTC	(20081116_0-26198)
  Log:
  - fix the schematest build
  - add in a schematest check for adding columns
  

  Modified:
	rserv/trunk/src/stest_main.c (File Modified) 
	rserv/trunk/src/stest_schema.c (File Modified) 


leeh        2008/09/07 11:19:09 UTC	(20080907_1-26030)
  Log:
  - make schema_init() take no params
  - remove the param schema_init() passed into rsdb_schema_check()
  - rserv.c needs rsdbs.h
  

  Modified:
	rserv/trunk/include/rsdbs.h (File Modified) 
	rserv/trunk/src/rsdbs_common.c (File Modified) 
	rserv/trunk/src/rsdbs_schema.c (File Modified) 
	rserv/trunk/src/rserv.c (File Modified) 
	rserv/trunk/src/stest_schema.c (File Modified) 


leeh        2008/09/07 10:33:15 UTC	(20080907_0-26028)
  Log:
  - pgsql support for dropping unique constraints
  

  Modified:
	rserv/trunk/src/rsdbs_pgsql.c (File Modified) 


leeh        2008/08/24 09:18:26 UTC	(20080824_1-25951)
  Log:
  - extend the schema generation to support removing UNIQUE constraints that
    no longer exist in the schema
  - still need to flesh out pgsql/sqlite
  

  Modified:
	rserv/trunk/include/rsdbs.h (File Modified) 
	rserv/trunk/src/rsdbs_common.c (File Modified) 
	rserv/trunk/src/rsdbs_mysql.c (File Modified) 
	rserv/trunk/src/rsdbs_pgsql.c (File Modified) 
	rserv/trunk/src/rsdbs_sqlite3.c (File Modified) 


leeh        2008/08/24 08:28:18 UTC	(20080824_0-25949)
  Log:
  - expand the test schema some more, and fix some indenting
  - generate the key names in the correct field order
  

  Modified:
	rserv/trunk/src/rsdbs_common.c (File Modified) 
	rserv/trunk/src/stest_schema.c (File Modified) 


leeh        2008/08/23 22:09:47 UTC	(20080823_1-25945)
  Log:
  - add in a schema test for adding unique constraints
  - renumber the passes we make
  

  Modified:
	rserv/trunk/src/stest_schema.c (File Modified) 


leeh        2008/08/23 21:54:54 UTC	(20080823_0-25941)
  Log:
  - fix the mysql JOIN for checking primary/unique keys to not duplicate
    results
  - mysql can't handle uniques on text fields without a length, so just swap
    the test schema out
  - make the schema generation handle a NULL key string, for the databases
    where the primary key is done in the table creation
  

  Modified:
	rserv/trunk/src/rsdbs_common.c (File Modified) 
	rserv/trunk/src/rsdbs_mysql.c (File Modified) 
	rserv/trunk/src/stest_schema.c (File Modified) 


leeh        2008/08/03 18:19:13 UTC	(20080803_1-25829)
  Log:
  - flesh out the schema testing somewhat and make it multi-pass
  

  Modified:
	rserv/trunk/src/stest_main.c (File Modified) 
	rserv/trunk/src/stest_schema.c (File Modified) 


leeh        2008/08/03 18:13:18 UTC	(20080803_0-25827)
  Log:
  - make rsdbs_common handle getting a schema set without columns/keys
  

  Modified:
	rserv/trunk/src/rsdbs_common.c (File Modified) 


leeh        2008/08/02 20:38:01 UTC	(20080802_4-25825)
  Log:
  - rerun make depend
  

  Modified:
	rserv/trunk/src/.depend (File Modified) 


leeh        2008/08/02 20:36:37 UTC	(20080802_3-25823)
  Log:
  - make the mlog() and die() functions in schematest real
  - fix how schema_init() is called
  

  Modified:
	rserv/trunk/src/stest_main.c (File Modified) 
	rserv/trunk/src/stest_schema.c (File Modified) 


leeh        2008/08/02 20:35:50 UTC	(20080802_2-25821)
  Log:
  - move the schema_init() prototype from rserv.h to rsdbs.h
  - make schema_init() take a value to pass down to rsdbs_check_schema()
  

  Modified:
	rserv/trunk/include/rsdbs.h (File Modified) 
	rserv/trunk/include/rserv.h (File Modified) 
	rserv/trunk/src/rsdbs_schema.c (File Modified) 


leeh        2008/08/02 20:26:56 UTC	(20080802_1-25819)
  Log:
  - add a quick variable to allow writing the schema straight to the database
  

  Modified:
	rserv/trunk/include/rsdbs.h (File Modified) 
	rserv/trunk/src/rsdbs_common.c (File Modified) 
	rserv/trunk/src/rsdbs_schema.c (File Modified) 


leeh        2008/08/02 19:52:30 UTC	(20080802_0-25817)
  Log:
  - initial start of a schema test program
  

  Modified:
	rserv/trunk/src/Makefile.in (File Modified) 
	rserv/trunk/src/stest_main.c (File Added) 
	rserv/trunk/src/stest_schema.c (File Added) 


leeh        2008/08/01 21:57:49 UTC	(20080801_5-25815)
  Log:
  - make sure the sql statements get added to the tail of the dlink, rather
    than the head
  

  Modified:
	rserv/trunk/src/rsdbs_common.c (File Modified) 


leeh        2008/08/01 21:54:33 UTC	(20080801_4-25813)
  Log:
  - fix Makefile for renaming of schema.c to rsdbs_schema.c
  

  Modified:
	rserv/trunk/src/Makefile.in (File Modified) 


leeh        2008/08/01 21:52:30 UTC	(20080801_3-25811)
  Log:
  - rename schema.c to rsdbs_schema.c
  

  Modified:
	rserv/trunk/src/rsdbs_schema.c (File Added) 
	rserv/trunk/src/schema.c (File Deleted) 


leeh        2008/08/01 21:18:55 UTC	(20080801_2-25809)
  Log:
  - move the sql handlers over to the new split schema structs
  

  Modified:
	rserv/trunk/src/rsdbs_mysql.c (File Modified) 
	rserv/trunk/src/rsdbs_pgsql.c (File Modified) 
	rserv/trunk/src/rsdbs_sqlite3.c (File Modified) 


leeh        2008/08/01 21:09:48 UTC	(20080801_1-25807)
  Log:
  - split the schema into separate structs for columns/keys
  

  Modified:
	rserv/trunk/include/rsdbs.h (File Modified) 
	rserv/trunk/src/rsdbs_common.c (File Modified) 
	rserv/trunk/src/schema.c (File Modified) 


leeh        2008/08/01 21:08:50 UTC	(20080801_0-25805)
  Log:
  - move a buf[0] = '\0'; slightly lower
  

  Modified:
	rserv/trunk/src/rsdbs_mysql.c (File Modified) 


leeh        2008/07/31 22:16:22 UTC	(20080731_0-25803)
  Log:
  - morph rsdb_schema_generate_element() over to a sql generating function,
    rsdbs_sql_create_element()
  

  Modified:
	rserv/trunk/include/rsdbs.h (File Modified) 
	rserv/trunk/src/rsdbs_common.c (File Modified) 
	rserv/trunk/src/rsdbs_mysql.c (File Modified) 
	rserv/trunk/src/rsdbs_pgsql.c (File Modified) 
	rserv/trunk/src/rsdbs_sqlite3.c (File Modified) 


leeh        2008/07/25 17:56:15 UTC	(20080725_0-25789)
  Log:
  - move rsdb stuff back to src/
    do the library stuff later, once libratbox has stabilised
  

  Modified:
	rserv/trunk/libratboxdb/ (File Deleted) 
	rserv/trunk/src/rsdb_common.c (File Added) 
	rserv/trunk/src/rsdb_mysql.c (File Added) 
	rserv/trunk/src/rsdb_pgsql.c (File Added) 
	rserv/trunk/src/rsdb_sqlite3.c (File Added) 
	rserv/trunk/src/rsdbs_common.c (File Added) 
	rserv/trunk/src/rsdbs_mysql.c (File Added) 
	rserv/trunk/src/rsdbs_pgsql.c (File Added) 
	rserv/trunk/src/rsdbs_sqlite3.c (File Added) 


leeh        2008/07/24 21:06:13 UTC	(20080724_6-25787)
  Log:
  - move the rsdb stuff into libratboxdb
  

  Modified:
	rserv/trunk/libratboxdb/rsdb_common.c (File Added) 
	rserv/trunk/libratboxdb/rsdb_mysql.c (File Added) 
	rserv/trunk/libratboxdb/rsdb_pgsql.c (File Added) 
	rserv/trunk/libratboxdb/rsdb_sqlite3.c (File Added) 
	rserv/trunk/libratboxdb/rsdbs_common.c (File Added) 
	rserv/trunk/libratboxdb/rsdbs_mysql.c (File Added) 
	rserv/trunk/libratboxdb/rsdbs_pgsql.c (File Added) 
	rserv/trunk/libratboxdb/rsdbs_sqlite3.c (File Added) 
	rserv/trunk/src/rsdb_common.c (File Deleted) 
	rserv/trunk/src/rsdb_mysql.c (File Deleted) 
	rserv/trunk/src/rsdb_pgsql.c (File Deleted) 
	rserv/trunk/src/rsdb_sqlite3.c (File Deleted) 
	rserv/trunk/src/rsdbs_common.c (File Deleted) 
	rserv/trunk/src/rsdbs_mysql.c (File Deleted) 
	rserv/trunk/src/rsdbs_pgsql.c (File Deleted) 
	rserv/trunk/src/rsdbs_sqlite3.c (File Deleted) 


leeh        2008/07/24 21:04:21 UTC	(20080724_5-25785)
  Log:
  - add in libratboxdb folder
  

  Modified:
	rserv/trunk/libratboxdb/ (File Added) 


leeh        2008/07/24 21:00:43 UTC	(20080724_4-25783)
  Log:
  - stop rsdb_* and rsdbs_* referencing the config file directly, and make
    them reference rsdb_conf instead
  

  Modified:
	rserv/trunk/src/rsdb_mysql.c (File Modified) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 
	rserv/trunk/src/rsdbs_mysql.c (File Modified) 


leeh        2008/07/24 20:56:12 UTC	(20080724_3-25781)
  Log:
  - add in a struct _rsdb_conf to hold the db config values
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/src/rsdb_common.c (File Modified) 
	rserv/trunk/src/rsdb_mysql.c (File Modified) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 
	rserv/trunk/src/rsdb_sqlite3.c (File Modified) 
	rserv/trunk/src/rserv.c (File Modified) 


leeh        2008/07/24 20:35:38 UTC	(20080724_2-25779)
  Log:
  - fix up sqlite3 dbs so it compiles, adding some dummy function handlers
    that need to be fleshed out
  

  Modified:
	rserv/trunk/src/rsdbs_sqlite3.c (File Modified) 


leeh        2008/07/24 20:32:09 UTC	(20080724_1-25777)
  Log:
  - move rsdb_schema_check_table() into rsdbs_common.c as rsdbs_check_table()
  - make various functions rsdb_schema_check_table() calls external
  

  Modified:
	rserv/trunk/include/rsdbs.h (File Modified) 
	rserv/trunk/src/rsdbs_common.c (File Modified) 
	rserv/trunk/src/rsdbs_mysql.c (File Modified) 
	rserv/trunk/src/rsdbs_pgsql.c (File Modified) 


leeh        2008/07/24 20:26:49 UTC	(20080724_0-25775)
  Log:
  - for pgsql, add rsdbs_check_key_pri() and rsdbs_check_key_unique() generic
    wrappers around the rsdbs_check_key_is() function
  - for pgsql/mysql, add rsdbs_sql_drop_key_pri() to return the SQL for
    dropping the primary key
  

  Modified:
	rserv/trunk/src/rsdbs_mysql.c (File Modified) 
	rserv/trunk/src/rsdbs_pgsql.c (File Modified) 


leeh        2008/07/17 20:28:05 UTC	(20080717_1-25765)
  Log:
  - split the mysql rsdb_schema_check_table() into multiple functions
  

  Modified:
	rserv/trunk/src/rsdbs_mysql.c (File Modified) 


leeh        2008/07/17 19:48:35 UTC	(20080717_0-25763)
  Log:
  - Id props
  

  Modified:
	rserv/trunk/include/rsdbs.h (File Modified) (Property Modified)
	rserv/trunk/src/rsdbs_common.c (File Modified) (Property Modified)
	rserv/trunk/src/rsdbs_mysql.c (File Modified) (Property Modified)
	rserv/trunk/src/rsdbs_pgsql.c (File Modified) (Property Modified)
	rserv/trunk/src/rsdbs_sqlite3.c (File Modified) (Property Modified)


leeh        2008/07/14 20:36:35 UTC	(20080714_1-25755)
  Log:
  - remove unused include/schema-sqlite.h
  - move all of the schema stuff out of rsdb_* and into rsdbs_*
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/include/rsdbs.h (File Added) 
	rserv/trunk/include/schema-sqlite.h (File Deleted) 
	rserv/trunk/src/Makefile.in (File Modified) 
	rserv/trunk/src/rsdb_common.c (File Modified) 
	rserv/trunk/src/rsdb_mysql.c (File Modified) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 
	rserv/trunk/src/rsdb_sqlite3.c (File Modified) 
	rserv/trunk/src/rsdbs_common.c (File Added) 
	rserv/trunk/src/rsdbs_mysql.c (File Added) 
	rserv/trunk/src/rsdbs_pgsql.c (File Added) 
	rserv/trunk/src/rsdbs_sqlite3.c (File Added) 
	rserv/trunk/src/schema.c (File Modified) 


leeh        2008/07/14 20:19:50 UTC	(20080714_0-25753)
  Log:
  - move some stuff out of rsdb_schema_check_table() and into functions
  

  Modified:
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 


leeh        2008/07/13 21:19:19 UTC	(20080713_8-25751)
  Log:
  - mysql requires the primary key is inline when adding AUTO_INCREMENT
    columns
  

  Modified:
	rserv/trunk/src/rsdb_mysql.c (File Modified) 


leeh        2008/07/13 21:00:07 UTC	(20080713_7-25749)
  Log:
  - make mysql/pgsql use rsdbs_generate_key_name() for generating the sql for
    unique columns and indexes
  

  Modified:
	rserv/trunk/src/rsdb_mysql.c (File Modified) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 


leeh        2008/07/13 16:38:34 UTC	(20080713_6-25747)
  Log:
  - add rsdbs_generate_key_name() to return the name of a key
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/src/rsdb_common.c (File Modified) 


leeh        2008/07/13 16:09:23 UTC	(20080713_5-25745)
  Log:
  - has_serial should be an integer
  - make rsdb_schema_generate_element() take the entire schema_set
  - have rsdb_schema_generate_element() for sqlite ignore the prikey field if
    there is a serial value
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/src/rsdb_common.c (File Modified) 
	rserv/trunk/src/rsdb_mysql.c (File Modified) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 
	rserv/trunk/src/rsdb_sqlite3.c (File Modified) 


leeh        2008/07/13 15:46:55 UTC	(20080713_4-25743)
  Log:
  - move that back to has_serial
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/src/rsdb_common.c (File Modified) 
	rserv/trunk/src/schema.c (File Modified) 


leeh        2008/07/13 09:55:08 UTC	(20080713_3-25741)
  Log:
  - fix an edge case where rsdbs_check_column() is called on a table that
    doesn't exist..
  

  Modified:
	rserv/trunk/src/rsdb_sqlite3.c (File Modified) 


leeh        2008/07/13 09:52:19 UTC	(20080713_2-25739)
  Log:
  - fill in rsdb_schema_check_table for sqlite for hunting columns
    This is pretty nasty, as there is no SELECT statement to return the
    information, so we have to wade through a PRAGMA table_info(..)
  

  Modified:
	rserv/trunk/src/rsdb_sqlite3.c (File Modified) 


leeh        2008/07/13 08:09:02 UTC	(20080713_1-25737)
  Log:
  - update the schema to have NULL rather than 0 for serial_field
  

  Modified:
	rserv/trunk/src/schema.c (File Modified) 


leeh        2008/07/13 08:08:09 UTC	(20080713_0-25735)
  Log:
  - swap has_serial for serial_name, and make it point to the name of the
    serial field
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/src/rsdb_common.c (File Modified) 


leeh        2008/07/12 09:13:56 UTC	(20080712_3-25733)
  Log:
  - flag each table in the schema as to whether it has a SERIAL reference or
    not, and build this when we run the schema check
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/src/rsdb_common.c (File Modified) 
	rserv/trunk/src/schema.c (File Modified) 


leeh        2008/07/12 08:55:14 UTC	(20080712_2-25731)
  Log:
  - add Id svn property
  

  Modified:
	rserv/trunk/src/cidr.c  (Property Modified)
	rserv/trunk/src/email.c (File Modified) (Property Modified)
	rserv/trunk/src/langs_format.c (File Modified) (Property Modified)
	rserv/trunk/src/log.c  (Property Modified)
	rserv/trunk/src/match.c  (Property Modified)
	rserv/trunk/src/modebuild.c  (Property Modified)
	rserv/trunk/src/newconf.c  (Property Modified)
	rserv/trunk/src/rsdb_pgsql.c (File Modified) (Property Modified)
	rserv/trunk/src/rserv.c  (Property Modified)
	rserv/trunk/src/s_alis.c  (Property Modified)
	rserv/trunk/src/s_banserv.c  (Property Modified)
	rserv/trunk/src/s_chanserv.c  (Property Modified)
	rserv/trunk/src/s_global.c  (Property Modified)
	rserv/trunk/src/s_jupeserv.c  (Property Modified)
	rserv/trunk/src/s_memoserv.c (File Modified) (Property Modified)
	rserv/trunk/src/s_nickserv.c  (Property Modified)
	rserv/trunk/src/s_operbot.c  (Property Modified)
	rserv/trunk/src/s_operserv.c  (Property Modified)
	rserv/trunk/src/s_userserv.c  (Property Modified)
	rserv/trunk/src/schema.c (File Modified) (Property Modified)
	rserv/trunk/src/scommand.c  (Property Modified)
	rserv/trunk/src/service.c  (Property Modified)
	rserv/trunk/src/snprintf.c (File Modified) (Property Modified)
	rserv/trunk/src/tools.c  (Property Modified)
	rserv/trunk/src/u_stats.c  (Property Modified)
	rserv/trunk/src/ucommand.c  (Property Modified)


leeh        2008/07/12 08:51:09 UTC	(20080712_1-25729)
  Log:
  - rename a couple of functions
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/src/rsdb_common.c (File Modified) 
	rserv/trunk/src/rsdb_mysql.c (File Modified) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 
	rserv/trunk/src/rsdb_sqlite3.c (File Modified) 


leeh        2008/07/12 08:39:38 UTC	(20080712_0-25727)
  Log:
  - move the hard work of checking whether a table exists for the schema into
    rsdb_common.c, and have the db implementations just return the SQL
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/src/rsdb_common.c (File Modified) 
	rserv/trunk/src/rsdb_mysql.c (File Modified) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 
	rserv/trunk/src/rsdb_sqlite3.c (File Modified) 


leeh        2008/07/07 20:43:06 UTC	(20080707_0-25687)
  Log:
  - fix up schema index generation for mysql
  

  Modified:
	rserv/trunk/src/rsdb_mysql.c (File Modified) 


leeh        2008/07/01 18:24:11 UTC	(20080701_0-25671)
  Log:
  - support for unique indexes to schema generation
  

  Modified:
	rserv/trunk/src/rsdb_mysql.c (File Modified) 


leeh        2008/06/30 20:11:33 UTC	(20080630_2-25667)
  Log:
  - primary keys for mysql schema check
  

  Modified:
	rserv/trunk/src/rsdb_mysql.c (File Modified) 


leeh        2008/06/30 19:32:40 UTC	(20080630_1-25665)
  Log:
  - start on the mysql schema checking
  

  Modified:
	rserv/trunk/src/rsdb_mysql.c (File Modified) 


leeh        2008/06/30 19:32:03 UTC	(20080630_0-25663)
  Log:
  - add a few missing rsdb_exec_fetch_end(), and some comments
  

  Modified:
	rserv/trunk/src/rsdb_common.c (File Modified) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 


leeh        2008/06/29 19:30:37 UTC	(20080629_2-25649)
  Log:
  - I will deal with foreign keys for pgsql later
  

  Modified:
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 


leeh        2008/06/29 18:54:50 UTC	(20080629_1-25647)
  Log:
  - fix up the schema checking for indexes, as well as can be done with pgsql
  - make the sql generation for indexes work for multiple fields
  

  Modified:
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 


leeh        2008/06/29 18:10:48 UTC	(20080629_0-25645)
  Log:
  - fix up UNIQUE constraints for pgsql
  

  Modified:
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 


leeh        2008/06/28 08:49:07 UTC	(20080628_0-25631)
  Log:
  - fix a database query using %s instead of %Q
  

  Modified:
	rserv/trunk/src/s_userserv.c (File Modified) 


leeh        2008/06/27 22:36:07 UTC	(20080627_1-25629)
  Log:
  - fix up the logic behind finding postgres primary keys
  

  Modified:
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 


leeh        2008/06/27 21:17:20 UTC	(20080627_0-25627)
  Log:
  - fix autoconf test for pcre header
  

  Modified:
	rserv/trunk/autoconf/configure.in (File Modified) 
	rserv/trunk/configure (File Modified) 


leeh        2008/05/31 08:14:47 UTC	(20080531_2-25502)
  Log:
  - move some code out into rsdb_common.c
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/src/Makefile.in (File Modified) 
	rserv/trunk/src/rsdb_common.c (File Added) 
	rserv/trunk/src/rsdb_mysql.c (File Modified) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 
	rserv/trunk/src/rsdb_sqlite3.c (File Modified) 


leeh        2008/05/31 07:55:29 UTC	(20080531_1-25500)
  Log:
  - rsdb_schema.c is unused nowadays
  

  Modified:
	rserv/trunk/src/Makefile.in (File Modified) 
	rserv/trunk/src/rsdb_schema.c (File Deleted) 


leeh        2008/05/31 07:54:16 UTC	(20080531_0-25498)
  Log:
  - add base support for synchronising primary keys/unique constraints for
    pgsql
  

  Modified:
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 


leeh        2008/05/30 18:40:06 UTC	(20080530_2-25496)
  Log:
  - first attempt at schema syncing for pgsql
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 
	rserv/trunk/src/schema.c (File Modified) 


leeh        2008/05/30 17:24:53 UTC	(20080530_1-25494)
  Log:
  - merge the remains of rsdb_schema.h into rsdb.h
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/include/rsdb_schema.h (File Deleted) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 
	rserv/trunk/src/rsdb_schema.c (File Modified) 
	rserv/trunk/src/rserv.c (File Modified) 
	rserv/trunk/src/schema.c (File Modified) 


leeh        2008/05/30 17:22:23 UTC	(20080530_0-25492)
  Log:
  - move primary keys into the db schema
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/include/rsdb_schema.h (File Modified) 
	rserv/trunk/src/rsdb_mysql.c (File Modified) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 
	rserv/trunk/src/rsdb_schema.c (File Modified) 
	rserv/trunk/src/rsdb_sqlite3.c (File Modified) 
	rserv/trunk/src/schema.c (File Modified) 


leeh        2008/05/29 19:35:11 UTC	(20080529_1-25490)
  Log:
  - add in support for foreign keys to pgsql, mysql/sqlite don't do these
    properly
  - extend the schema with the foreign keys.  pgsql now appears to be
    correct..
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/src/rsdb_mysql.c (File Modified) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 
	rserv/trunk/src/rsdb_sqlite3.c (File Modified) 
	rserv/trunk/src/schema.c (File Modified) 


leeh        2008/05/29 19:27:26 UTC	(20080529_0-25488)
  Log:
  - change debugging to print sql to stdout
  

  Modified:
	rserv/trunk/src/rsdb_schema.c (File Modified) 


leeh        2008/05/28 19:09:51 UTC	(20080528_1-25484)
  Log:
  - refactor some code so that there is a rsdb_schema_generate_element() to
    generate the sql for each table element, which is contained within the
    relevant rsdb_ src code
  

  Modified:
	rserv/trunk/include/rsdb.h (File Modified) 
	rserv/trunk/include/rsdb_schema.h (File Modified) 
	rserv/trunk/src/rsdb_mysql.c (File Modified) 
	rserv/trunk/src/rsdb_pgsql.c (File Modified) 
	rserv/trunk/src/rsdb_schema.c (File Modified) 
	rserv/trunk/src/rsdb_sqlite3.c (File Modified) 


leeh        2008/05/28 18:30:10 UTC	(20080528_0-25472)
  Log:
  - add support for indexes/uniques to the schema generation
  - generate the field values independently, without separators
  

  Modified:
	rserv/trunk/include/rsdb_schema.h (File Modified) 
	rserv/trunk/src/rsdb_schema.c (File Modified) 
	rserv/trunk/src/schema.c (File Modified) 


leeh        2008/05/27 20:57:20 UTC	(20080527_5-25470)
  Log:
  - finish updating the base schema
  

  Modified:
	rserv/trunk/src/schema.c (File Modified) 


leeh        2008/05/27 20:50:46 UTC	(20080527_4-25468)
  Log:
  - add 'CHAR' type to schema generation
  

  Modified:
	rserv/trunk/include/rsdb_schema.h (File Modified) 
	rserv/trunk/src/rsdb_schema.c (File Modified) 


leeh        2008/05/27 20:48:20 UTC	(20080527_3-25466)
  Log:
  - missing break;
  

  Modified:
	rserv/trunk/src/rsdb_schema.c (File Modified) 


leeh        2008/05/27 19:27:19 UTC	(20080527_2-25464)
  Log:
  - extend rsdb_schema to support booleans, and references to SERIAL values
  

  Modified:
	rserv/trunk/include/rsdb_schema.h (File Modified) 
	rserv/trunk/src/rsdb_schema.c (File Modified) 


leeh        2008/05/27 17:56:12 UTC	(20080527_1-25462)
  Log:
  - make it clear via a typedef that the option value in rsdb_schema.h points
    to the schema value above
  

  Modified:
	rserv/trunk/include/rsdb_schema.h (File Modified) 


leeh        2008/05/27 17:53:28 UTC	(20080527_0-25460)
  Log:
  - move the schema out into schema.c
  - add support for 'TEXT' values
  

  Modified:
	rserv/trunk/include/rsdb_schema.h (File Modified) 
	rserv/trunk/include/rserv.h (File Modified) 
	rserv/trunk/src/Makefile.in (File Modified) 
	rserv/trunk/src/rsdb_schema.c (File Modified) 
	rserv/trunk/src/rserv.c (File Modified) 
	rserv/trunk/src/schema.c (File Added) 


leeh        2008/05/24 08:33:14 UTC	(20080524_0-25458)
  Log:
  - globalise rsdb_schema_set, and pass that around instead of the raw values
    from it
  

  Modified:
	rserv/trunk/include/rsdb_schema.h (File Modified) 
	rserv/trunk/src/rsdb_schema.c (File Modified) 


leeh        2008/05/23 22:40:10 UTC	(20080523_10-25456)
  Log:
  - primary_key test should be EmptyString() not just an if()
  

  Modified:
	rserv/trunk/src/rsdb_schema.c (File Modified) 


leeh        2008/05/23 22:37:01 UTC	(20080523_9-25454)
  Log:
  - add a superstruct to amalgamate the structures of schema tables
  

  Modified:
	rserv/trunk/src/rsdb_schema.c (File Modified) 


leeh        2008/05/23 22:24:52 UTC	(20080523_8-25452)
  Log:
  - add in users_resetpass table to the schema generation
  - fix so we don't generate primary key fields at the end for sqlite, as they
    go inline with the INTEGER declaration
  

  Modified:
	rserv/trunk/src/rsdb_schema.c (File Modified) 


leeh        2008/05/23 22:07:09 UTC	(20080523_7-25450)
  Log:
  - add id properties on rsdb_schema.{c|h}
  - add in BSD license to rsdb_schema.c
  

  Modified:
	rserv/trunk/include/rsdb_schema.h  (Property Modified)
	rserv/trunk/src/rsdb_schema.c (File Modified) (Property Modified)


leeh        2008/05/23 22:06:16 UTC	(20080523_6-25448)
  Log:
  - add in some funky schema generation..
  

  Modified:
	rserv/trunk/src/rsdb_schema.c (File Modified) 


leeh        2008/05/23 21:41:53 UTC	(20080523_5-25446)
  Log:
  - add new '-c' option to binary to create the initial database table set
  

  Modified:
	rserv/trunk/src/rserv.c (File Modified) 


leeh        2008/05/23 21:33:18 UTC	(20080523_4-25444)
  Log:
  - base stuff for the schema generation
  

  Modified:
	rserv/trunk/include/rsdb_schema.h (File Added) 
	rserv/trunk/src/Makefile.in (File Modified) 
	rserv/trunk/src/rsdb_schema.c (File Added) 


leeh        2008/05/23 21:30:08 UTC	(20080523_3-25442)
  Log:
  - apply ratbox-sqlite3 externals flag
  

  Modified:
	rserv/trunk/  (Property Modified)


leeh        2008/05/23 21:27:15 UTC	(20080523_2-25440)
  Log:
  - create defines for RSERV_DB_MYSQL/RSERV_DB_PGSQL/RSERV_DB_SQLITE as
    appropriate
  

  Modified:
	rserv/trunk/autoconf/configure.in (File Modified) 
	rserv/trunk/configure (File Modified) 
	rserv/trunk/include/setup.h.in (File Modified) 


leeh        2008/05/23 21:26:22 UTC	(20080523_1-25438)
  Log:
  - build target for sqlite is now ratbox-sqlite3
  

  Modified:
	rserv/trunk/autoconf/configure.in (File Modified) 
	rserv/trunk/configure (File Modified) 


leeh        2008/05/23 17:58:30 UTC	(20080523_0-25435)
  Log:
  - remove sqlite3 sources, in preparation for it being an externals
  

  Modified:
	rserv/trunk/sqlite3/ (File Deleted) 


leeh        2008/05/20 20:28:18 UTC	(20080520_8-25422)
  Log:
  - disable threading and handlers in sqlite by default
  

  Modified:
	rserv/trunk/sqlite3/configure (File Modified) 
	rserv/trunk/sqlite3/configure.ac (File Modified) 


leeh        2008/05/20 20:16:44 UTC	(20080520_7-25420)
  Log:
  - add new sqlite amalgamation sources
  

  Modified:
	rserv/trunk/sqlite3/INSTALL (File Added) 
	rserv/trunk/sqlite3/Makefile.am (File Added) 
	rserv/trunk/sqlite3/Makefile.in (File Added) 
	rserv/trunk/sqlite3/README (File Added) 
	rserv/trunk/sqlite3/aclocal.m4 (File Added) 
	rserv/trunk/sqlite3/bootstrap.sh (File Added) 
	rserv/trunk/sqlite3/config.guess (File Added) 
	rserv/trunk/sqlite3/config.sub (File Added) 
	rserv/trunk/sqlite3/configure (File Added) 
	rserv/trunk/sqlite3/configure.ac (File Added) 
	rserv/trunk/sqlite3/depcomp (File Added) 
	rserv/trunk/sqlite3/install-sh (File Added) 
	rserv/trunk/sqlite3/ltmain.sh (File Added) 
	rserv/trunk/sqlite3/missing (File Added) 
	rserv/trunk/sqlite3/shell.c (File Added) 
	rserv/trunk/sqlite3/sqlite3.c (File Added) 
	rserv/trunk/sqlite3/sqlite3.h (File Added) 
	rserv/trunk/sqlite3/sqlite3ext.h (File Added) 


leeh        2008/05/20 20:14:44 UTC	(20080520_6-25418)
  Log:
  - remove the old sqlite3 sources in preparation for new amalgamation
  

  Modified:
	rserv/trunk/sqlite3/Makefile.in (File Deleted) 
	rserv/trunk/sqlite3/README (File Deleted) 
	rserv/trunk/sqlite3/VERSION (File Deleted) 
	rserv/trunk/sqlite3/aclocal.m4 (File Deleted) 
	rserv/trunk/sqlite3/config.guess (File Deleted) 
	rserv/trunk/sqlite3/config.sub (File Deleted) 
	rserv/trunk/sqlite3/configure (File Deleted) 
	rserv/trunk/sqlite3/configure.ac (File Deleted) 
	rserv/trunk/sqlite3/install-sh (File Deleted) 
	rserv/trunk/sqlite3/ltmain.sh (File Deleted) 
	rserv/trunk/sqlite3/main.mk (File Deleted) 
	rserv/trunk/sqlite3/mkso.sh (File Deleted) 
	rserv/trunk/sqlite3/spec.template (File Deleted) 
	rserv/trunk/sqlite3/sqlite.pc.in (File Deleted) 
	rserv/trunk/sqlite3/sqlite3.1 (File Deleted) 
	rserv/trunk/sqlite3/sqlite3.def (File Deleted) 
	rserv/trunk/sqlite3/sqlite3.h (File Deleted) 
	rserv/trunk/sqlite3/sqlite3.pc.in (File Deleted) 
	rserv/trunk/sqlite3/src/ (File Deleted) 
	rserv/trunk/sqlite3/tool/ (File Deleted) 


leeh        2008/05/20 20:05:41 UTC	(20080520_5-25416)
  Log:
  - move the sqlite schema over to being contained in the core code
  

  Modified:
	rserv/trunk/include/schema-sqlite.h (File Added) 
	rserv/trunk/src/rsdb_sqlite3.c (File Modified) 
	rserv/trunk/tools/base/schema-sqlite.txt (File Deleted) 
	rserv/trunk/tools/generate-schema.pl (File Modified) 


leeh        2008/05/20 19:54:51 UTC	(20080520_4-25414)
  Log:
  - I always forget to update the documentation..
  

  Modified:
	rserv/trunk/RELEASE_NOTES (File Modified) 
	rserv/trunk/SVN-Access (File Modified) 


leeh        2008/05/20 19:52:47 UTC	(20080520_3-25412)
  Log:
  - this is now 1.3.0beta
  

  Modified:
	rserv/trunk/autoconf/configure.in (File Modified) 
	rserv/trunk/configure (File Modified) 
	rserv/trunk/include/config.h (File Modified) 



